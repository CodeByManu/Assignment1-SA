{% extends "app/base.html" %}
{% block title %}Authors Table{% endblock %}
{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="m-0">Authors report</h2>
    </div>

    <form class="row g-2 mb-3" method="get">
        <div class="col-md-3">
            <input class="form-control" type="text" name="name" placeholder="Filter by name" value="{{ request.GET.name }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" name="books_min" placeholder="Min books" value="{{ request.GET.books_min }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" name="books_max" placeholder="Max books" value="{{ request.GET.books_max }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" step="0.1" name="avg_min" placeholder="Min avg" value="{{ request.GET.avg_min }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" step="0.1" name="avg_max" placeholder="Max avg" value="{{ request.GET.avg_max }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" name="sales_min" placeholder="Min sales" value="{{ request.GET.sales_min }}">
        </div>
        <div class="col-md-2">
            <input class="form-control" type="number" name="sales_max" placeholder="Max sales" value="{{ request.GET.sales_max }}">
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100" type="submit">Apply</button>
        </div>
        <div class="col-md-2">
            <a class="btn btn-outline-secondary w-100" href="?">Reset</a>
        </div>
    
        <input type="hidden" name="page" value="{{ page_obj.number }}">
    
            <div class="col-12">
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm align-middle mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>
                                        <a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'name' %}-name{% else %}name{% endif %}">
                                            Name
                                            {% if sort == 'name' %}<small>↑</small>{% elif sort == '-name' %}<small>↓</small>{% endif %}
                                        </a>
                                    </th>
                                    <th class="text-end">
                                        <a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'book_count' %}-book_count{% else %}book_count{% endif %}">
                                            Books
                                            {% if sort == 'book_count' %}<small>↑</small>{% elif sort == '-book_count' %}<small>↓</small>{% endif %}
                                        </a>
                                    </th>
                                    <th class="text-end">
                                        <a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'avg_score' %}-avg_score{% else %}avg_score{% endif %}">
                                            Avg score
                                            {% if sort == 'avg_score' %}<small>↑</small>{% elif sort == '-avg_score' %}<small>↓</small>{% endif %}
                                        </a>
                                    </th>
                                    <th class="text-end">
                                        <a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'total_sales' %}-total_sales{% else %}total_sales{% endif %}">
                                            Total sales
                                            {% if sort == 'total_sales' %}<small>↑</small>{% elif sort == '-total_sales' %}<small>↓</small>{% endif %}
                                        </a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for a in page_obj.object_list %}
                                <tr>
                                    <td><a href="{% url 'author_detail' a.id %}">{{ a.name }}</a></td>
                                    <td class="text-end">{{ a.book_count }}</td>
                                    <td class="text-end">{% if a.avg_score is not None %}{{ a.avg_score|floatformat:2 }}{% else %}-{% endif %}</td>
                                    <td class="text-end">{{ a.total_sales }}</td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="4" class="text-center text-muted py-4">No data</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-3">{% include 'app/_pagination_bootstrap.html' %}</div>
            </div>
    </form>

{% endblock %}
