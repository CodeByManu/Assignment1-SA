{% extends "app/base.html" %}
{% block title %}Top Rated Books{% endblock %}
{% block content %}
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h2 class="m-0">Top 10 rated books</h2>
	</div>
	<div class="card">
		<div class="table-responsive">
			<table class="table table-striped table-hover table-sm align-middle mb-0"
				   style="table-layout: fixed; width: 100%">
				<thead class="table-dark">
					<tr>
						<th style="width: 22%">
							<a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'name' %}-name{% else %}name{% endif %}">
								Book
								{% if sort == 'name' %}<small>↑</small>{% elif sort == '-name' %}<small>↓</small>{% endif %}
							</a>
						</th>
						<th style="width: 16%">
							<a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'author' %}-author{% else %}author{% endif %}">
								Author
								{% if sort == 'author' %}<small>↑</small>{% elif sort == '-author' %}<small>↓</small>{% endif %}
							</a>
						</th>
						<th class="text-end" style="width: 10%">
							<a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'avg_score' %}-avg_score{% else %}avg_score{% endif %}">
								Avg score
								{% if sort == 'avg_score' %}<small>↑</small>{% elif sort == '-avg_score' %}<small>↓</small>{% endif %}
							</a>
						</th>
						<th class="text-end" style="width: 10%">
							<a class="text-reset ms-1" href="?{% if querystring %}{{ querystring }}&{% endif %}sort={% if sort == 'review_count' %}-review_count{% else %}review_count{% endif %}">
								Reviews
								{% if sort == 'review_count' %}<small>↑</small>{% elif sort == '-review_count' %}<small>↓</small>{% endif %}
							</a>
						</th>
						<th style="width: 21%">Highest rated popular review</th>
						<th style="width: 21%">Lowest rated popular review</th>
					</tr>
				</thead>
				<tbody>
					{% for b in books %}
						<tr>
							<td><a href="{% url 'book_detail' b.id %}">{{ b.name }}</a></td>
							<td><a href="{% url 'author_detail' b.author.id %}">{{ b.author.name }}</a></td>
							<td class="text-end">{{ b.avg_score|floatformat:2 }}</td>
							<td class="text-end">{{ b.review_count }}</td>
							<td>
								{% if b.high_review %}
									<div><small class="text-muted">Score {{ b.high_review.score }} • ↑ {{ b.high_review.upvotes }}</small></div>
									<div class="text-truncate w-100" title="{{ b.high_review.review }}">{{ b.high_review.review|truncatechars:160 }}</div>
								{% else %}-{% endif %}
							</td>
							<td>
								{% if b.low_review %}
									<div><small class="text-muted">Score {{ b.low_review.score }} • ↑ {{ b.low_review.upvotes }}</small></div>
									<div class="text-truncate w-100" title="{{ b.low_review.review }}">{{ b.low_review.review|truncatechars:160 }}</div>
								{% else %}-{% endif %}
							</td>
						</tr>
					{% empty %}
						<tr>
							<td colspan="6" class="text-center text-muted py-4">No data</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
{% endblock %}
